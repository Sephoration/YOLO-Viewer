## 视频播放逻辑修复方案

### 问题分析

视频播放逻辑出现无限循环问题，具体流程如下：
1. 用户拖动进度条 → 触发`progress_changed`信号
2. `progress_changed`信号 → 调用`handle_progress_change`方法
3. `handle_progress_change`方法 → 调用`video_player.seek_frame(target_frame)`
4. `seek_frame`方法 → 触发`progress_updated`信号
5. `progress_updated`信号 → 调用`_on_progress_updated`方法
6. `_on_progress_updated`方法 → 调用`left_panel.set_progress_value(progress_value)`
7. `set_progress_value`方法 → 改变进度条位置 → 又触发`progress_changed`信号
8. 形成无限循环

### 解决方案

在`handle_progress_change`方法中添加一个标志，避免递归调用。

### 实现步骤

1. 在`YOLOMainController`类中添加一个标志变量`is_seeking`，用于标记是否正在手动跳转进度
2. 在`handle_progress_change`方法开始时设置`is_seeking = True`
3. 在`_on_progress_updated`方法中检查`is_seeking`标志，如果正在手动跳转则不更新进度条
4. 在`handle_progress_change`方法结束时设置`is_seeking = False`

### 代码修改

#### 1. 在`YOLOMainController.__init__`方法中添加标志变量
```python
# 进度跳转标志
self.is_seeking = False
```

#### 2. 修改`_on_progress_updated`方法
```python
def _on_progress_updated(self, current_frame, total_frames, current_time):
    """视频进度更新"""
    try:
        if self.current_mode == 'video':
            self.left_panel.set_progress_range(0, 1000)
            
            if total_frames > 0:
                progress_value = int((current_frame / total_frames) * 1000)
                # 只有在非手动跳转时才更新进度条，避免无限循环
                if not self.is_seeking:
                    self.left_panel.set_progress_value(progress_value)
            
            current_time_str = self._format_time(current_time)
            total_time_str = self._format_time(total_frames / self.video_player.fps) if self.video_player.fps > 0 else "--:--"
            self.left_panel.set_time_display(current_time_str, total_time_str)
            
    except Exception as e:
        print(f"更新进度失败: {e}")
```

#### 3. 修改`handle_progress_change`方法
```python
def handle_progress_change(self, value):
    """用户拖动进度条"""
    if self.current_mode == 'video' and hasattr(self.video_player, 'cap') and self.video_player.cap:
        try:
            # 设置手动跳转标志，避免无限循环
            self.is_seeking = True
            
            total_frames = self.video_player.total_frames
            if total_frames > 0:
                target_frame = int((value / 1000.0) * total_frames)
                self.video_player.seek_frame(target_frame)
                
                print(f"跳转到进度: {value}/1000, 帧号: {target_frame}/{total_frames}")
        except Exception as e:
            print(f"跳转进度失败: {e}")
        finally:
            # 无论是否成功，都要重置手动跳转标志
            self.is_seeking = False
```

### 预期效果

修复后，当用户拖动进度条时：
1. `handle_progress_change`方法会设置`is_seeking = True`
2. 调用`video_player.seek_frame`跳转到目标帧
3. `seek_frame`方法触发`progress_updated`信号
4. `_on_progress_updated`方法检查到`is_seeking = True`，跳过`set_progress_value`调用
5. `handle_progress_change`方法结束时设置`is_seeking = False`
6. 避免了无限循环

### 测试验证

1. 启动应用程序
2. 加载视频文件
3. 拖动进度条
4. 检查是否不再出现无限循环的进度跳转输出
5. 检查视频播放是否正常

### 其他优化建议

1. 在`left_panel.set_progress_value`方法中添加参数`emit_signal=False`，避免在程序内部更新进度时触发信号
2. 优化进度条更新逻辑，减少不必要的更新
3. 添加日志记录，方便调试

### 实现时间表

- 代码修改：15分钟
- 测试验证：10分钟
- 文档更新：5分钟

### 风险评估

- 低风险：修改范围小，只涉及进度条更新逻辑
- 高可靠性：修复后避免了无限循环，提高了系统稳定性
- 无副作用：修改不影响其他功能

### 技术栈

- Python
- PySide6
- Qt信号槽机制

### 预期成果

- 修复视频播放逻辑的无限循环问题
- 提高系统稳定性
- 改善用户体验
- 提供可扩展的进度条更新机制